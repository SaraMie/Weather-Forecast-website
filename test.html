<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>List Files in Directory</title>
</head>
<body>
<button onclick="listFiles()">List Files</button>
<pre id="fileList"></pre>

<script>
async function listFiles() {
  const directoryHandle = await window.showDirectoryPicker();
  const filesObject = await getFiles(directoryHandle);
  const filesJSON = JSON.stringify(filesObject, null, 2);
  document.getElementById('fileList').textContent = filesJSON;
}

async function getFiles(directoryHandle) {
  const filesObject = {};
  for await (const [name, handle] of directoryHandle.entries()) {
    if (handle.kind === 'file') {
      if (!filesObject[directoryHandle.name]) {
        filesObject[directoryHandle.name] = [];
      }
      filesObject[directoryHandle.name].push(name);
    } else if (handle.kind === 'directory') {
      filesObject[name] = await getFiles(handle);
    }
  }
  return filesObject;
}
</script>
</body>
</html>
